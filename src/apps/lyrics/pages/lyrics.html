{% extends "templates/app.html" %}
{% block head %}
<style>
    html, body {
        overflow: hidden;
    }
    #lyrics {
        text-align: center;
        font-size: 20px;
        transition: transform 500ms;
        transform: translateY(50vh);
        width: calc(100% - 50px);
        padding-left: 25px;
        display: flex;
        flex-direction: column;
    }
    .lyric {
        transition: font-size 500ms;
        padding-bottom: 10px;
    }
    .lyric.current {
        font-size: 25px;
        font-weight: 999;
    }
</style>
{% endblock %}
{% block content %}
<div id="lyrics">
</div>
{% endblock %}
{% block script %}
<script>
    let automove = true;
    let lyrics = [];
    let pos = 0;
    let lpos = 0;
    let playing = true;
    const lyricsInner = document.getElementById("lyrics")
    on("lyrics", (lyr) => {
        lyricsInner.innerHTML = '';
        automove = true;
        lyrics = []
        if (lyr != null) {
            lyr.forEach(rd => {
                let line = rd
                var span = document.createElement("span")
                if (typeof line === 'string') {
                    automove = false;
                } else {
                    line = line[1]
                    lyrics.push([rd[0], span])
                }
                if (line == '') {
                    line = 'â™¬';
                }
                span.classList = ['lyric']
                span.textContent = line
                lyricsInner.appendChild(span)
            });
        }
    })
    on("music", (tpos) => {
        pos = tpos[0];
        playing = tpos[1];
    })
    function highlightLyric() {
        if (!automove) {
            return
        }
        ld = true;
        for (let i = lyrics.length - 1; i >= 0; i--) {
            if (ld && lyrics[i][0] <= pos) {
                ld = false
                if (lpos != i) {
                    lyricsInner.style.transform = `translateY(calc(50vh - ${lyrics[i][1].offsetTop}px))`
                    lyrics[i][1].classList = ['lyric current']
                }
            } else {
                lyrics[i][1].classList = ['lyric']
            }
        }
        if (playing) {
            pos += 10;
        }
    }
    setInterval(highlightLyric, 20) // Probably could be lower
    send("open", 0)
</script>
{% endblock %}